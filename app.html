<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wrist-Relief AI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <!-- Add marked for Markdown parsing -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;500;600;700&family=Inter:wght@300;400;600&display=swap');

        body {
            font-family: 'Inter', sans-serif;
            background-color: #0f172a; /* Slate 900 */
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
        }

        /* Phone Frame for Desktop Viewing */
        .phone-frame {
            width: 100%;
            max-width: 400px;
            height: 100vh;
            max-height: 850px;
            background-color: #000;
            border-radius: 30px;
            overflow: hidden;
            position: relative;
            box-shadow: 0 20px 50px rgba(0, 255, 255, 0.1);
            border: 8px solid #1e293b;
        }

        @media (max-width: 640px) {
            .phone-frame {
                border-radius: 0;
                max-width: 100%;
                max-height: 100%;
                height: 100vh;
                border: none;
            }
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 4px;
        }
        ::-webkit-scrollbar-track {
            background: #0f172a;
        }
        ::-webkit-scrollbar-thumb {
            background: #334155;
            border-radius: 2px;
        }

        /* Neon Glow Effects */
        .neon-text {
            text-shadow: 0 0 5px rgba(34, 211, 238, 0.5);
        }
        .neon-border {
            box-shadow: 0 0 10px rgba(34, 211, 238, 0.2);
        }
        
        .font-tech {
            font-family: 'Rajdhani', sans-serif;
        }

        /* Navigation Active State */
        .nav-item.active {
            color: #22d3ee; /* Cyan 400 */
        }
        .nav-item.active svg {
            stroke: #22d3ee;
            filter: drop-shadow(0 0 5px rgba(34, 211, 238, 0.5));
        }

        /* Animations */
        @keyframes pulse-red {
            0% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(239, 68, 68, 0); }
            100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); }
        }
        .animate-pulse-red {
            animation: pulse-red 2s infinite;
        }

        .hidden { display: none !important; } /* Force hide */
        
        /* Gauge Animation */
        .gauge-fill {
            transition: stroke-dashoffset 0.5s ease-in-out;
        }

        /* Markdown Styles in AI Response */
        .prose p {
            margin-bottom: 0.5em;
            font-size: 0.875rem;
            line-height: 1.4;
            color: #cbd5e1;
        }
        .prose strong {
            color: #22d3ee;
            font-weight: 700;
        }
        .prose ul {
            list-style-type: disc;
            padding-left: 1.2em;
            margin-bottom: 0.5em;
            color: #94a3b8;
        }
        .prose li {
            margin-bottom: 0.25em;
        }

        /* Loading Scanner Effect */
        @keyframes scan {
            0% { top: 0%; opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { top: 100%; opacity: 0; }
        }
        .scanner-line {
            position: absolute;
            left: 0;
            width: 100%;
            height: 2px;
            background: #22d3ee;
            box-shadow: 0 0 10px #22d3ee;
            animation: scan 1.5s linear infinite;
        }

        /* Toggle Switch */
        .toggle-checkbox:checked {
            right: 0;
            border-color: #22d3ee;
        }
        .toggle-checkbox:checked + .toggle-label {
            background-color: #22d3ee;
        }
    </style>
</head>
<body class="text-slate-200">

    <div class="phone-frame flex flex-col bg-slate-950 relative">
        
        <!-- Status Bar (Mock) -->
        <div class="flex justify-between items-center px-6 py-3 bg-slate-950/90 backdrop-blur-md z-40 absolute top-0 w-full">
            <div class="text-xs font-tech tracking-widest text-slate-400">12:42 PM</div>
            <div class="flex gap-2 items-center">
                <div id="connection-status" class="w-2 h-2 rounded-full bg-green-500 shadow-[0_0_8px_rgba(34,197,94,0.8)]"></div>
                <svg class="w-4 h-4 text-slate-400" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"/></svg>
                <svg class="w-4 h-4 text-slate-400" fill="currentColor" viewBox="0 0 24 24"><path d="M15.67 4H14V2h-4v2H8.33C7.6 4 7 4.6 7 5.33v15.33C7 21.4 7.6 22 8.33 22h7.33c.74 0 1.34-.6 1.34-1.33V5.33C17 4.6 16.4 4 15.67 4z"/></svg>
            </div>
        </div>

        <!-- AUTH SCREEN (Login/Signup) -->
        <div id="auth-container" class="h-full flex flex-col justify-center px-8 relative z-30 bg-slate-950 pt-10">
            <!-- Decorative Backglow -->
            <div class="absolute top-1/4 left-1/2 -translate-x-1/2 w-64 h-64 bg-cyan-500/10 rounded-full blur-3xl -z-10"></div>
            
            <!-- Logo Section -->
            <div class="text-center mb-12">
                <h1 class="font-tech text-5xl font-bold text-white tracking-wider uppercase mb-2"><span class="text-cyan-400">WRIST</span>AI</h1>
                <p class="text-sm text-slate-400 uppercase tracking-widest">Tactical Ergonomics</p>
            </div>

            <!-- Login Form -->
            <div id="login-form" class="space-y-6 w-full animate-fade-in">
                <div class="space-y-2">
                    <label class="text-xs text-cyan-400 font-tech uppercase tracking-wide">Operative ID / Email</label>
                    <input type="email" placeholder="agent@wrist.ai" onkeydown="if(event.key === 'Enter') handleLogin()" class="w-full bg-slate-900 border border-slate-700 rounded-xl px-4 py-3 text-white focus:outline-none focus:border-cyan-400 focus:shadow-[0_0_10px_rgba(34,211,238,0.3)] transition-all">
                </div>
                <div class="space-y-2">
                    <label class="text-xs text-cyan-400 font-tech uppercase tracking-wide">Passcode</label>
                    <input type="password" placeholder="••••••••" onkeydown="if(event.key === 'Enter') handleLogin()" class="w-full bg-slate-900 border border-slate-700 rounded-xl px-4 py-3 text-white focus:outline-none focus:border-cyan-400 focus:shadow-[0_0_10px_rgba(34,211,238,0.3)] transition-all">
                </div>
                
                <button onclick="handleLogin(this)" class="w-full bg-cyan-500 hover:bg-cyan-400 text-slate-900 font-bold py-3 rounded-xl transition-all shadow-[0_0_15px_rgba(34,211,238,0.4)] mt-4">
                    INITIALIZE SYSTEM
                </button>

                <p class="text-center text-xs text-slate-500 mt-6">
                    New Recruit? <button onclick="toggleAuthMode()" class="text-cyan-400 hover:text-cyan-300 underline underline-offset-2">Register Identity</button>
                </p>
            </div>

            <!-- Signup Form (Hidden initially) -->
            <div id="signup-form" class="hidden space-y-5 w-full animate-fade-in">
                <div class="space-y-2">
                    <label class="text-xs text-purple-400 font-tech uppercase tracking-wide">Callsign / Username</label>
                    <input type="text" placeholder="e.g. CyberMedic" onkeydown="if(event.key === 'Enter') handleLogin()" class="w-full bg-slate-900 border border-slate-700 rounded-xl px-4 py-3 text-white focus:outline-none focus:border-purple-400 focus:shadow-[0_0_10px_rgba(168,85,247,0.3)] transition-all">
                </div>
                <div class="space-y-2">
                    <label class="text-xs text-purple-400 font-tech uppercase tracking-wide">Email</label>
                    <input type="email" placeholder="agent@wrist.ai" onkeydown="if(event.key === 'Enter') handleLogin()" class="w-full bg-slate-900 border border-slate-700 rounded-xl px-4 py-3 text-white focus:outline-none focus:border-purple-400 focus:shadow-[0_0_10px_rgba(168,85,247,0.3)] transition-all">
                </div>
                <div class="space-y-2">
                    <label class="text-xs text-purple-400 font-tech uppercase tracking-wide">Set Passcode</label>
                    <input type="password" placeholder="••••••••" onkeydown="if(event.key === 'Enter') handleLogin()" class="w-full bg-slate-900 border border-slate-700 rounded-xl px-4 py-3 text-white focus:outline-none focus:border-purple-400 focus:shadow-[0_0_10px_rgba(168,85,247,0.3)] transition-all">
                </div>
                
                <button onclick="handleLogin(this)" class="w-full bg-purple-600 hover:bg-purple-500 text-white font-bold py-3 rounded-xl transition-all shadow-[0_0_15px_rgba(147,51,234,0.4)] mt-4">
                    CREATE PROFILE
                </button>

                <p class="text-center text-xs text-slate-500 mt-6">
                    Already registered? <button onclick="toggleAuthMode()" class="text-purple-400 hover:text-purple-300 underline underline-offset-2">Log In</button>
                </p>
            </div>
        </div>

        <!-- APP CONTAINER (Main App) -->
        <div id="app-container" class="hidden h-full flex flex-col pt-10"> <!-- Added pt-10 to account for absolute status bar -->
            
            <!-- Header -->
            <header class="px-6 py-4 flex justify-between items-end z-10 relative shrink-0">
                <div>
                    <h1 class="font-tech text-3xl font-bold text-white tracking-wider uppercase"><span class="text-cyan-400">WRIST</span>AI</h1>
                    <p class="text-xs text-slate-400 uppercase tracking-widest">Ergonomic Guardian</p>
                </div>
                <button onclick="switchTab('settings')" id="settings-btn" class="p-2 rounded-full bg-slate-800 hover:bg-slate-700 transition-colors border border-slate-700">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-slate-300"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.38a2 2 0 0 0-.73-2.73l-.15-.1a2 2 0 0 1-1-1.72v-.51a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"></path><circle cx="12" cy="12" r="3"></circle></svg>
                </button>
            </header>

            <!-- Content Area -->
            <main class="flex-1 overflow-y-auto pb-24 relative no-scrollbar">
                
                <!-- Dashboard View -->
                <section id="view-dashboard" class="px-6 space-y-6 animate-fade-in">
                    
                    <!-- Main Strain Gauge -->
                    <div class="relative w-full aspect-square max-h-[300px] mx-auto flex items-center justify-center">
                        <!-- Decorative background rings -->
                        <div class="absolute inset-0 rounded-full border border-slate-800/50 scale-90"></div>
                        <div class="absolute inset-0 rounded-full border border-slate-800/30 scale-75"></div>
                        
                        <!-- SVG Gauge -->
                        <svg class="w-full h-full transform -rotate-90" viewBox="0 0 100 100">
                            <circle cx="50" cy="50" r="45" fill="none" stroke="#1e293b" stroke-width="8" />
                            <circle id="strain-gauge" cx="50" cy="50" r="45" fill="none" stroke="#22d3ee" stroke-width="8" stroke-dasharray="283" stroke-dashoffset="200" stroke-linecap="round" class="gauge-fill drop-shadow-[0_0_10px_rgba(34,211,238,0.5)]" />
                        </svg>

                        <!-- Center Info -->
                        <div class="absolute text-center z-10">
                            <div class="text-xs text-slate-400 uppercase tracking-widest mb-1">Strain Load</div>
                            <div id="strain-value" class="text-5xl font-tech font-bold text-white">34%</div>
                            <div id="strain-status" class="text-sm font-semibold text-cyan-400 mt-1">Optimal</div>
                        </div>
                        
                        <!-- Live Status Dot -->
                        <div class="absolute bottom-4 flex items-center gap-2 bg-slate-800/80 px-3 py-1 rounded-full backdrop-blur-sm border border-slate-700">
                            <div class="w-2 h-2 bg-red-500 rounded-full animate-pulse"></div>
                            <span class="text-xs font-bold tracking-wide">LIVE MONITORING</span>
                        </div>
                    </div>

                    <!-- Quick Stats Grid -->
                    <div class="grid grid-cols-2 gap-4">
                        <div class="bg-slate-900 border border-slate-800 p-4 rounded-2xl hover:border-slate-700 transition-colors">
                            <div class="flex items-center gap-2 mb-2 text-slate-400">
                                <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
                                <span class="text-xs font-bold uppercase">Session</span>
                            </div>
                            <div class="text-2xl font-tech font-bold">02:14<span class="text-sm text-slate-500 ml-1">hr</span></div>
                        </div>
                        <div class="bg-slate-900 border border-slate-800 p-4 rounded-2xl hover:border-slate-700 transition-colors">
                            <div class="flex items-center gap-2 mb-2 text-slate-400">
                                <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></svg>
                                <span class="text-xs font-bold uppercase">APM</span>
                            </div>
                            <div class="text-2xl font-tech font-bold">142<span class="text-sm text-slate-500 ml-1">avg</span></div>
                        </div>
                    </div>

                    <!-- Action Banner -->
                    <div id="alert-banner" class="bg-gradient-to-r from-slate-800 to-slate-900 p-4 rounded-2xl border-l-4 border-emerald-500 shadow-lg flex justify-between items-center">
                        <div>
                            <h3 class="font-bold text-white text-sm">Wrist Angle: Good</h3>
                            <p class="text-xs text-slate-400 mt-1">Keep neutral position.</p>
                        </div>
                        <button onclick="startStretch()" class="bg-slate-700 hover:bg-slate-600 text-white text-xs px-4 py-2 rounded-lg font-semibold transition-colors">
                            Check
                        </button>
                    </div>

                </section>

                <!-- Exercises View -->
                <section id="view-exercises" class="px-6 space-y-6 hidden">
                    <h2 class="text-xl font-tech font-bold text-white border-l-4 border-cyan-400 pl-3">Recovery Protocols</h2>
                    
                    <!-- Exercise Card 1 -->
                    <div class="bg-slate-900 rounded-2xl p-4 border border-slate-800 relative overflow-hidden group">
                        <div class="absolute top-0 right-0 bg-cyan-500/10 px-3 py-1 rounded-bl-xl text-cyan-400 text-xs font-bold font-tech">RECOMMENDED</div>
                        <div class="flex gap-4 items-center">
                            <div class="w-16 h-16 bg-slate-800 rounded-xl flex items-center justify-center text-3xl">
                                FS
                            </div>
                            <div class="flex-1">
                                <h3 class="font-bold text-white">Flexor Stretch</h3>
                                <p class="text-xs text-slate-400 mt-1">Relieves forearm tension from mouse grip.</p>
                                <div class="flex items-center gap-2 mt-3">
                                    <div class="h-1.5 w-24 bg-slate-800 rounded-full overflow-hidden">
                                        <div class="h-full w-2/3 bg-cyan-400 rounded-full"></div>
                                    </div>
                                    <span class="text-xs text-cyan-400">2 min</span>
                                </div>
                            </div>
                            <button class="w-10 h-10 rounded-full bg-cyan-500 hover:bg-cyan-400 flex items-center justify-center text-slate-900 transition-colors">
                                <svg class="w-5 h-5 fill-current" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
                            </button>
                        </div>
                    </div>

                    <!-- Exercise Card 2 -->
                    <div class="bg-slate-900 rounded-2xl p-4 border border-slate-800 relative overflow-hidden group">
                        <div class="flex gap-4 items-center">
                            <div class="w-16 h-16 bg-slate-800 rounded-xl flex items-center justify-center text-3xl">
                                WR
                            </div>
                            <div class="flex-1">
                                <h3 class="font-bold text-white">Wrist Rotations</h3>
                                <p class="text-xs text-slate-400 mt-1">Increases blood flow & mobility.</p>
                                <div class="flex items-center gap-2 mt-3">
                                    <div class="h-1.5 w-24 bg-slate-800 rounded-full overflow-hidden">
                                        <div class="h-full w-0 bg-cyan-400 rounded-full"></div>
                                    </div>
                                    <span class="text-xs text-slate-500">Start</span>
                                </div>
                            </div>
                            <button class="w-10 h-10 rounded-full bg-slate-700 hover:bg-slate-600 flex items-center justify-center text-white transition-colors">
                                <svg class="w-5 h-5 fill-current" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
                            </button>
                        </div>
                    </div>
                </section>

                <!-- AI Coach View -->
                <section id="view-aicoach" class="px-6 space-y-6 hidden h-full flex flex-col">
                    <h2 class="text-xl font-tech font-bold text-white border-l-4 border-purple-500 pl-3">AI Tactical Support</h2>
                    
                    <!-- AI Stats Action -->
                    <div class="bg-gradient-to-br from-purple-900/40 to-slate-900 border border-purple-500/30 p-5 rounded-2xl relative overflow-hidden shrink-0">
                        <div class="relative z-10">
                            <h3 class="text-white font-bold text-lg">Session Debrief</h3>
                            <p class="text-slate-400 text-xs mt-1 mb-3">Analyze current biomechanics and generate a recovery strategy.</p>
                            <button onclick="generateAIDebrief()" class="w-full py-2 bg-purple-600 hover:bg-purple-500 text-white text-sm font-bold rounded-lg transition-all shadow-[0_0_15px_rgba(147,51,234,0.4)] flex items-center justify-center gap-2">
                                <span>✨ Generate Tactical Report</span>
                            </button>
                        </div>
                        <!-- BG effect -->
                        <div class="absolute -right-10 -top-10 w-32 h-32 bg-purple-500/10 rounded-full blur-2xl"></div>
                    </div>

                    <!-- AI Chat/Consult -->
                    <div class="bg-slate-900 border border-slate-800 p-4 rounded-2xl flex-1 flex flex-col min-h-0">
                        <h3 class="text-sm font-bold text-slate-300 mb-2 flex items-center gap-2 shrink-0">
                            <svg class="w-4 h-4 text-cyan-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"></path></svg>
                            Field Medic Console
                        </h3>
                        
                        <!-- Response Area -->
                        <div id="ai-response-area" class="flex-1 bg-slate-950 rounded-xl p-3 mb-3 overflow-y-auto border border-slate-800 relative">
                            <div id="ai-placeholder" class="text-slate-600 text-xs text-center mt-10 italic">
                                "Awaiting input for ergonomic analysis..."
                            </div>
                            <div id="ai-loading" class="hidden absolute inset-0 bg-slate-950/80 z-20 flex flex-col items-center justify-center">
                                <div class="relative w-full h-full overflow-hidden rounded-xl">
                                    <div class="scanner-line"></div>
                                    <div class="absolute inset-0 flex items-center justify-center text-cyan-400 font-tech tracking-widest text-sm animate-pulse">
                                        ANALYZING BIOMETRICS...
                                    </div>
                                </div>
                            </div>
                            <div id="ai-content" class="prose prose-invert hidden"></div>
                        </div>

                        <!-- Input Area -->
                        <div class="flex gap-2 shrink-0">
                            <input type="text" id="ai-input" placeholder="e.g. 'My left thumb hurts...'" class="flex-1 bg-slate-800 border-none rounded-lg px-3 py-2 text-sm text-white placeholder-slate-500 focus:ring-1 focus:ring-cyan-400 outline-none">
                            <button onclick="askAI()" class="bg-slate-700 hover:bg-slate-600 text-white p-2 rounded-lg transition-colors">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>
                            </button>
                        </div>
                    </div>
                </section>

                <!-- Stats View -->
                <section id="view-stats" class="px-6 space-y-6 hidden">
                    <h2 class="text-xl font-tech font-bold text-white border-l-4 border-purple-500 pl-3">Performance Data</h2>
                    <!-- Chart Container -->
                    <div class="bg-slate-900 p-4 rounded-2xl border border-slate-800">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-sm font-bold text-slate-300">Strain Over Time</h3>
                            <select class="bg-slate-800 text-xs text-slate-300 rounded px-2 py-1 border-none outline-none">
                                <option>Last Hour</option>
                                <option>Today</option>
                                <option>Week</option>
                            </select>
                        </div>
                        <div class="h-40 w-full relative">
                            <canvas id="strainChart"></canvas>
                        </div>
                    </div>
                </section>

                <!-- Settings View (New) -->
                <section id="view-settings" class="px-6 space-y-6 hidden">
                    <h2 class="text-xl font-tech font-bold text-white border-l-4 border-slate-500 pl-3">System Config</h2>
                    
                    <div class="bg-slate-900 rounded-2xl border border-slate-800 overflow-hidden">
                        <!-- Setting Item -->
                        <div class="p-4 flex justify-between items-center border-b border-slate-800">
                            <div>
                                <h3 class="text-sm font-bold text-white">Haptic Feedback</h3>
                                <p class="text-xs text-slate-500">Vibrate on strain alert</p>
                            </div>
                            <div class="relative inline-block w-10 mr-2 align-middle select-none transition duration-200 ease-in">
                                <input type="checkbox" name="toggle" id="toggle-haptic" class="toggle-checkbox absolute block w-5 h-5 rounded-full bg-white border-4 appearance-none cursor-pointer border-slate-700 checked:right-0 checked:border-cyan-400 transition-all duration-300"/>
                                <label for="toggle-haptic" class="toggle-label block overflow-hidden h-5 rounded-full bg-slate-700 cursor-pointer"></label>
                            </div>
                        </div>
                        <!-- Setting Item -->
                        <div class="p-4 flex justify-between items-center border-b border-slate-800">
                            <div>
                                <h3 class="text-sm font-bold text-white">Audio Cues</h3>
                                <p class="text-xs text-slate-500">Voice assist alerts</p>
                            </div>
                            <div class="relative inline-block w-10 mr-2 align-middle select-none transition duration-200 ease-in">
                                <input type="checkbox" name="toggle" id="toggle-audio" class="toggle-checkbox absolute block w-5 h-5 rounded-full bg-white border-4 appearance-none cursor-pointer border-slate-700 checked:right-0 checked:border-cyan-400 transition-all duration-300"/>
                                <label for="toggle-audio" class="toggle-label block overflow-hidden h-5 rounded-full bg-slate-700 cursor-pointer"></label>
                            </div>
                        </div>
                        <!-- Setting Item -->
                        <div class="p-4 flex justify-between items-center">
                            <div>
                                <h3 class="text-sm font-bold text-white">Smart Sensitivity</h3>
                                <p class="text-xs text-slate-500">Auto-adjust to APM</p>
                            </div>
                            <div class="relative inline-block w-10 mr-2 align-middle select-none transition duration-200 ease-in">
                                <input type="checkbox" name="toggle" id="toggle-smart" class="toggle-checkbox absolute block w-5 h-5 rounded-full bg-white border-4 appearance-none cursor-pointer border-slate-700 checked:right-0 checked:border-cyan-400 transition-all duration-300" checked/>
                                <label for="toggle-smart" class="toggle-label block overflow-hidden h-5 rounded-full bg-slate-700 cursor-pointer"></label>
                            </div>
                        </div>
                    </div>

                    <div class="bg-slate-900 rounded-2xl border border-slate-800 overflow-hidden p-4">
                        <div class="flex items-center gap-3 mb-4">
                            <div class="w-10 h-10 rounded-full bg-gradient-to-br from-cyan-400 to-blue-500 flex items-center justify-center text-slate-900 font-bold">
                                JD
                            </div>
                            <div>
                                <h3 class="text-white font-bold text-sm">John Doe</h3>
                                <p class="text-xs text-slate-500">Free Tier License</p>
                            </div>
                        </div>
                        <button onclick="handleLogout()" class="w-full border border-red-500/50 text-red-400 hover:bg-red-500/10 py-2 rounded-lg text-sm font-semibold transition-colors">
                            Disconnect Neural Link (Logout)
                        </button>
                    </div>
                </section>

            </main>

            <!-- Bottom Navigation -->
            <nav id="bottom-nav" class="bg-slate-950 border-t border-slate-900 px-6 py-4 flex justify-between items-center z-20 absolute bottom-0 w-full rounded-b-[30px]">
                <button onclick="switchTab('dashboard')" class="nav-item active flex flex-col items-center gap-1 text-slate-500 transition-all hover:text-slate-300">
                    <svg class="w-6 h-6 transition-all" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="7" height="7"></rect><rect x="14" y="3" width="7" height="7"></rect><rect x="14" y="14" width="7" height="7"></rect><rect x="3" y="14" width="7" height="7"></rect></svg>
                    <span class="text-[10px] font-medium tracking-wide">Monitor</span>
                </button>
                <button onclick="switchTab('exercises')" class="nav-item flex flex-col items-center gap-1 text-slate-500 transition-all hover:text-slate-300">
                    <svg class="w-6 h-6 transition-all" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20.24 12.24a6 6 0 0 0-8.49-8.49L5 10.5V19h8.5z"></path><line x1="16" y1="8" x2="2" y2="22"></line><line x1="17.5" y1="15" x2="9" y2="15"></line></svg>
                    <span class="text-[10px] font-medium tracking-wide">Recovery</span>
                </button>
                <!-- New AI Tab Button -->
                <button onclick="switchTab('aicoach')" class="nav-item flex flex-col items-center gap-1 text-slate-500 transition-all hover:text-slate-300">
                    <svg class="w-6 h-6 transition-all" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2a10 10 0 1 0 10 10H12V2z"></path><path d="M12 12L2.1 12a10 10 0 0 1 9.9-10V12z"></path><circle cx="12" cy="12" r="4"></circle></svg>
                    <span class="text-[10px] font-medium tracking-wide">AI Coach</span>
                </button>
                <button onclick="switchTab('stats')" class="nav-item flex flex-col items-center gap-1 text-slate-500 transition-all hover:text-slate-300">
                    <svg class="w-6 h-6 transition-all" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 3v18h18"/><path d="M18.7 8l-5.1 5.2-2.8-2.7L7 14.3"/></svg>
                    <span class="text-[10px] font-medium tracking-wide">Data</span>
                </button>
            </nav>
        </div>

        <!-- Critical Alert Overlay (Hidden by default) -->
        <div id="critical-alert" class="absolute inset-0 bg-red-950/90 backdrop-blur-md z-50 hidden flex flex-col items-center justify-center text-center p-6 animate-fade-in">
            <div class="w-20 h-20 rounded-full bg-red-500/20 flex items-center justify-center mb-4 animate-pulse-red">
                <svg class="w-10 h-10 text-red-500" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>
            </div>
            <h2 class="text-2xl font-tech font-bold text-white mb-2 uppercase">High Strain Detected</h2>
            <p class="text-slate-300 mb-8 text-sm">Your carpal pressure has exceeded safe thresholds for 10 minutes.</p>
            <button onclick="dismissAlert()" class="w-full bg-red-500 hover:bg-red-600 text-white font-bold py-3 rounded-xl transition-colors">
                Start Emergency Stretch
            </button>
            <button onclick="dismissAlert()" class="mt-4 text-slate-400 text-xs underline">Ignore (Not Recommended)</button>
        </div>

    </div>

    <script>
        // --- API Configuration ---
        const apiKey = ""; // Environment provides this

        // --- AUTH LOGIC ---
        const authContainer = document.getElementById('auth-container');
        const appContainer = document.getElementById('app-container');
        const loginForm = document.getElementById('login-form');
        const signupForm = document.getElementById('signup-form');

        function toggleAuthMode() {
            if(loginForm.classList.contains('hidden')) {
                loginForm.classList.remove('hidden');
                signupForm.classList.add('hidden');
            } else {
                loginForm.classList.add('hidden');
                signupForm.classList.remove('hidden');
            }
        }

        function handleLogin(btnElement) {
            // Determine the button if not passed (e.g. via Enter key)
            let btn = btnElement;
            if (!btn) {
                // Find which form is currently visible
                const isLoginVisible = !loginForm.classList.contains('hidden');
                const activeForm = isLoginVisible ? loginForm : signupForm;
                // The main action button is the first button in the form
                btn = activeForm.querySelector('button');
            }
            
            if (!btn) return; // Safety check

            const originalText = btn.innerText;
            btn.innerText = "AUTHENTICATING...";
            btn.disabled = true;

            setTimeout(() => {
                authContainer.classList.add('hidden');
                appContainer.classList.remove('hidden');
                btn.innerText = originalText;
                btn.disabled = false;
                switchTab('dashboard'); // Start at dashboard
                
                // Start tracking logic only after login
                startStrainTracking();
            }, 1000);
        }

        function handleLogout() {
            appContainer.classList.add('hidden');
            authContainer.classList.remove('hidden');
            // Reset to dashboard for next login
            switchTab('dashboard');
            // Stop background tracking
            if(strainInterval) clearInterval(strainInterval);
        }

        // --- Simulation Logic ---

        // Tab Switching
        function switchTab(tabName) {
            // Hide all views
            document.querySelectorAll('section').forEach(el => el.classList.add('hidden'));
            
            // Show target view
            const targetView = document.getElementById(`view-${tabName}`);
            if(targetView) targetView.classList.remove('hidden');
            
            // Handle Navigation State
            const navItems = document.querySelectorAll('.nav-item');
            navItems.forEach(btn => btn.classList.remove('active'));
            
            // Settings logic: If settings, no bottom nav item is active. If others, highlight.
            if(tabName !== 'settings') {
                const map = {
                    'dashboard': 0,
                    'exercises': 1,
                    'aicoach': 2,
                    'stats': 3
                };
                if(map[tabName] !== undefined) {
                    navItems[map[tabName]].classList.add('active');
                }
            }

            if (tabName === 'stats') renderChart();
        }

        // Strain Gauge Simulation
        const strainValueEl = document.getElementById('strain-value');
        const strainGaugeEl = document.getElementById('strain-gauge');
        const strainStatusEl = document.getElementById('strain-status');
        const alertBanner = document.getElementById('alert-banner');
        const circumference = 283;

        let currentStrain = 34; // Global variable to track strain for AI
        let strainInterval = null;

        function updateStrain(percentage) {
            currentStrain = percentage;
            const offset = circumference - (percentage / 100) * circumference;
            strainGaugeEl.style.strokeDashoffset = offset;
            strainValueEl.innerText = `${percentage}%`;
            
            if (percentage < 40) {
                strainGaugeEl.style.stroke = '#22d3ee';
                strainStatusEl.innerText = "Optimal";
                strainStatusEl.className = "text-sm font-semibold text-cyan-400 mt-1";
                alertBanner.className = "bg-gradient-to-r from-slate-800 to-slate-900 p-4 rounded-2xl border-l-4 border-emerald-500 shadow-lg flex justify-between items-center";
                alertBanner.querySelector('h3').innerText = "Wrist Angle: Good";
            } else if (percentage < 75) {
                strainGaugeEl.style.stroke = '#facc15';
                strainStatusEl.innerText = "Moderate Load";
                strainStatusEl.className = "text-sm font-semibold text-yellow-400 mt-1";
                alertBanner.className = "bg-gradient-to-r from-slate-800 to-slate-900 p-4 rounded-2xl border-l-4 border-yellow-500 shadow-lg flex justify-between items-center";
                alertBanner.querySelector('h3').innerText = "Micro-break needed soon";
            } else {
                strainGaugeEl.style.stroke = '#ef4444';
                strainStatusEl.innerText = "CRITICAL";
                strainStatusEl.className = "text-sm font-bold text-red-500 mt-1 animate-pulse";
                if(Math.random() > 0.85) showCriticalAlert(); // Reduced frequency
            }
        }

        function startStrainTracking() {
            if(strainInterval) clearInterval(strainInterval);
            strainInterval = setInterval(() => {
                const newVal = Math.floor(Math.random() * (85 - 20 + 1) + 20);
                updateStrain(newVal);
            }, 4000);
            updateStrain(34); // Initial set
        }

        function showCriticalAlert() { document.getElementById('critical-alert').classList.remove('hidden'); }
        function dismissAlert() {
            document.getElementById('critical-alert').classList.add('hidden');
            updateStrain(30);
        }
        function startStretch() { switchTab('exercises'); }

        // Chart.js
        let chartInstance = null;
        function renderChart() {
            const ctx = document.getElementById('strainChart').getContext('2d');
            if (chartInstance) return;
            const gradient = ctx.createLinearGradient(0, 0, 0, 200);
            gradient.addColorStop(0, 'rgba(34, 211, 238, 0.5)');
            gradient.addColorStop(1, 'rgba(34, 211, 238, 0)');

            chartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['10m', '20m', '30m', '40m', '50m', '60m'],
                    datasets: [{
                        label: 'Wrist Strain',
                        data: [25, 30, 45, 40, 60, 34],
                        borderColor: '#22d3ee',
                        backgroundColor: gradient,
                        tension: 0.4,
                        fill: true,
                        pointBackgroundColor: '#0f172a',
                        pointBorderColor: '#22d3ee',
                        pointBorderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: { grid: { color: '#1e293b' }, ticks: { color: '#64748b' } },
                        x: { grid: { display: false }, ticks: { color: '#64748b' } }
                    }
                }
            });
        }
        
        // --- GEMINI AI LOGIC ---
        
        async function callGemini(prompt) {
            // UI States
            const loadingEl = document.getElementById('ai-loading');
            const contentEl = document.getElementById('ai-content');
            const placeholderEl = document.getElementById('ai-placeholder');
            const responseArea = document.getElementById('ai-response-area');
            
            loadingEl.classList.remove('hidden');
            contentEl.classList.add('hidden');
            placeholderEl.classList.add('hidden');

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: prompt }] }]
                    })
                });

                const data = await response.json();
                const rawText = data.candidates?.[0]?.content?.parts?.[0]?.text || "Data corruption. Connection failed.";
                
                // Format output (Parse Markdown)
                contentEl.innerHTML = marked.parse(rawText);
                contentEl.classList.remove('hidden');
                
                // Auto scroll to top
                responseArea.scrollTop = 0;

            } catch (error) {
                contentEl.innerHTML = '<span class="text-red-400">Error: Communication relay severed. Please try again.</span>';
                contentEl.classList.remove('hidden');
                console.error(error);
            } finally {
                loadingEl.classList.add('hidden');
            }
        }

        function generateAIDebrief() {
            // Contextual Prompt
            const apm = 142; // Hardcoded mock from UI
            const sessionTime = "2h 14m";
            
            const prompt = `You are Wrist-Relief AI, a sci-fi tactical medical assistant for a gamer. 
            The user just finished a gaming session.
            Stats:
            - Current Strain Load: ${currentStrain}%
            - Average APM: ${apm}
            - Session Duration: ${sessionTime}
            
            Provide a concise "Post-Match Debrief" (under 100 words).
            1. Assess their condition using gamer terms (e.g., "HP low", "Debuffs detected").
            2. Suggest a specific physical "cooldown" action based on the strain level.
            3. End with a short, witty motivational quote about durability.
            Format as a bulleted list.`;

            callGemini(prompt);
        }

        function askAI() {
            const inputEl = document.getElementById('ai-input');
            const query = inputEl.value.trim();
            if (!query) return;

            const prompt = `You are Wrist-Relief AI, an expert ergonomic coach for gamers with a futuristic, tactical persona.
            User Report: "${query}"
            
            Provide immediate, actionable advice (under 80 words). 
            Focus on biomechanics (posture, stretch, angle). 
            Use bold text for key actions.`;

            callGemini(prompt);
            inputEl.value = ''; // Clear input
        }
    </script>
</body>
</html>
